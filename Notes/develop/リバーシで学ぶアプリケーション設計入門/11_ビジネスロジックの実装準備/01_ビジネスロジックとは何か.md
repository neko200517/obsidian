---
date: <% tp.date.now("YYYY-MM-DD") %>
tags:
  - typescript
  - express
  - 設計
  - オブジェクト指向
  - DI
  - 3層アーキテクチャ
  - デザインパターン
aliases:
  - <% tp.file.title %>
---

## 3 層アプリケーション

- プレゼンテーション層
- ビジネスロジック層
- データアクセス層

### プレゼンテーション層

アプリケーションの利用者（人間や別のプログラム）とやりとりする

### ビジネスロジック層

「システムのコア」や「システムの目的の処理をするところ」

### データアクセス層

DB やファイルなどのデータの保存先とやり取りする

## リバーシアプリケーションのビジネスロジック

- データアクセス層を使って 1 つ前のターンを取得する
- 盤面に置けるかチェック
- 石を置く
- ひっくり返す
- データアクセス層を使ってターンを保存する

## ビジネスロジックの判定

### リクエストの形式チェックはビジネスロジックか？

- リクエスト形式チェック
  - バリデーション
    - リクエストの必須パラメータか
    - 文字列のサイズは決められた範囲か

⇒ 　プレゼンテーション層であるべき

- 利用者とのインタフェースでの約束事に関するチェックであること
- 不正なデータはできるだけ早く検知し、以後のプログラムには進ませないようにしたい
- DB とのやりとりが不要なため簡単に実装できること

### リクエストの形式より少しだけ複雑な条件チェックはビジネスロジックか？

- SNS で自分には「いいね」できないようにする
- TODO 管理アプリで過去日の TODO は登録できないように関する

⇒ 　ビジネスロジックにするべき

- プレゼンテーション層は見た目などの UI に直接かかわることだけを知っているべきであり、このような知識を持つべきではないこと
- ユーザーインタフェースが GUI か API か CLI かといった、プレゼンテーション層の違いによらず、共通したチェックであると想定されること

### DB のデータとの整合性チェックはビジネスロジックか？

- リバーシで現在の盤面を踏まえ、指定された場所に石を置くことができるか判定する
- EC サイトで購入リクエストした商品が購入可能なものかを判定する

⇒ 　ビジネスロジックにするべき

- アプリケーションが従うべきルールのチェックであったり、ルールを適用する計算処理がまさにビジネスロジックの中心だから

## ドメインロジックとユースケース

ビジネスロジック層の処理は 2 種類に分類すると整理しやすい。

TurnService の registerTurn メソッドの例だと

- データアクセス層を使って 1 つ前のターンを取得する
- 盤面に置けるかチェック
- 石を置く
- ひっくり返す
- データアクセス層を使ってターンを保存する

### 処理の流れを実現する

⇒ 　ユースケース、アプリケーションビジネスルールと呼ばれる

### システム都合ではないコアなルール

⇒ 　ドメインロジック、エンタープライズビジネスルールと呼ばれる

## ドメインロジックの例

### リバーシ

- 盤面に置けるかチェック
- はさまれた石をひっくり返す

### ホテルの予約

- 指定された部屋に宿泊できる人数の予約かチェック
- 何日前のキャンセルなのでキャンセル料はいくらか算出

⇒ 　システムなしで現在世界で同じことをやろうとしたときに登場するルールはドメインロジックのわかりやすい例である
